"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _mithril=require("mithril"),_mithril2=_interopRequireDefault(_mithril),DEFAULT_SLIDER_ID="default",DEFAULT_DURATION=360,DEFAULT_ORIENTATION="ltr",RTL_ORIENTATION="rtl",DIRECTION_FORWARD=1,DIRECTION_FORWARD_CLASS="forward",DIRECTION_BACKWARD=-1,DIRECTION_BACKWARD_CLASS="backward",vms={},pageSlider={},prefixes=["webkit","moz","ms","o",""],prefixedEvent=function(element,type,callback){for(var p=0;p<prefixes.length;p++)prefixes[p]||(type=type.toLowerCase()),element.addEventListener(prefixes[p]+type,callback,!1)},ViewModel=function(){var transition=_mithril2["default"].prop({});return{pageElements:{},transition:transition,clearTransition:function(){transition().page=void 0},hasTransition:function(){return void 0!==transition().page},orientation:_mithril2["default"].prop(DEFAULT_ORIENTATION),current:_mithril2["default"].prop(),currentId:_mithril2["default"].prop(),previous:_mithril2["default"].prop(),next:_mithril2["default"].prop(),history:_mithril2["default"].prop({}),depth:_mithril2["default"].prop(0)}},getViewModel=function(){var id=arguments.length<=0||void 0===arguments[0]?DEFAULT_SLIDER_ID:arguments[0];return vms[id]=vms[id]||new ViewModel,vms[id]},pageElProps=function(which,key,duration,vm,opts){return{key:key,"class":opts.pageClass||null,config:function(el,inited){inited||(vm.pageElements[which]=el)},style:{"-webkit-animation-duration":duration+"ms","animation-duration":duration+"ms"}}},slide=function(opts){var sliderId=opts.slider||DEFAULT_SLIDER_ID,vm=getViewModel(sliderId);if(!vm.hasTransition()){var route=opts.route||_mithril2["default"].route(),id=opts.id||route,currentId=vm.currentId();if(void 0===currentId||currentId!==id||!vm.current()){var transition={page:opts.page,id:id,route:route,done:opts.done,direction:opts.direction||DIRECTION_FORWARD,duration:opts.duration||DEFAULT_DURATION};if(vm.orientation(opts.rtl?RTL_ORIENTATION:DEFAULT_ORIENTATION),vm.current()){var depth=vm.depth(),historyDepth=vm.history()[route],newDepth=void 0!==historyDepth?historyDepth:depth+transition.direction,backward=opts.direction===DIRECTION_BACKWARD||newDepth<depth;vm.depth(newDepth),vm.history()[route]=newDepth,backward?(transition.direction=DIRECTION_BACKWARD,vm.previous(transition.page)):(transition.direction=DIRECTION_FORWARD,vm.next(transition.page)),vm.transition(transition)}else vm.current(transition.page),vm.currentId(transition.id),vm.history()[transition.route]=0,transition.done&&transition.done(),vm.clearTransition();_mithril2["default"].redraw()}}},slideDone=function(vm){var transition=vm.transition(),route=transition.route,done=transition.done;vm.current(transition.page),vm.currentId(transition.id),transition.direction===DIRECTION_BACKWARD?(vm.next(vm.current()),vm.previous(null)):(vm.previous(vm.current()),vm.next(null)),vm.clearTransition(),_mithril2["default"].route(route),done&&done()},createView=function(opts,sliderId){var vm=getViewModel(sliderId),previous=vm.previous(),current=vm.current(),next=vm.next(),transition=vm.transition(),isAnimating=vm.hasTransition(),orientation=vm.orientation(),duration=void 0!==transition.duration?transition.duration:DEFAULT_DURATION,directionClass=transition.direction===DIRECTION_FORWARD?DIRECTION_FORWARD_CLASS:DIRECTION_BACKWARD_CLASS,pages=[previous?(0,_mithril2["default"])(".page.previous",pageElProps("previous",1,duration,vm,opts),previous):null,current?(0,_mithril2["default"])(".page.current",pageElProps("current",2,duration,vm,opts),current):null,next?(0,_mithril2["default"])(".page.next",pageElProps("next",3,duration,vm,opts),next):null];return orientation===RTL_ORIENTATION&&pages.reverse(),(0,_mithril2["default"])("div",{"class":["pageSlider",isAnimating?"animating":null,directionClass,orientation,opts["class"]||null].join(" "),config:function(){if(isAnimating){var done=function(){slideDone(vm)};prefixedEvent(vm.pageElements.current,"AnimationEnd",done)}}},pages)},slideConfig=function(fn,opts){return function(element,inited){inited||(element.onclick=function(e){e.preventDefault(),opts.route=element.getAttribute("href"),fn(opts)})}};pageSlider.slideInConfig=function(opts){return slideConfig(pageSlider.slideIn,opts)},pageSlider.slideOutConfig=function(opts){return slideConfig(pageSlider.slideOut,opts)},pageSlider.slideIn=function(opts){opts.direction=DIRECTION_FORWARD,slide(opts)},pageSlider.slideOut=function(opts){opts.direction=DIRECTION_BACKWARD,slide(opts)},pageSlider.view=function(ctrl){var opts=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],sliderId=opts.slider||DEFAULT_SLIDER_ID,vm=getViewModel(sliderId);if(!vm.hasTransition()){var page=opts.page;page&&slide({slider:sliderId,page:page,id:opts.id,route:opts.route,done:opts.done,rtl:opts.rtl})}return createView(opts,sliderId)},exports["default"]=pageSlider;
//# sourceMappingURL=mithril-page-slider.js.map