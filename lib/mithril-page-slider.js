"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _mithril=require("mithril"),_mithril2=_interopRequireDefault(_mithril),DEFAULT_SLIDER_ID="default",DEFAULT_DURATION=360,DEFAULT_ORIENTATION="ltr",RTL_ORIENTATION="rtl",DIRECTION_FORWARD=1,DIRECTION_FORWARD_CLASS="forward",DIRECTION_BACKWARD=-1,DIRECTION_BACKWARD_CLASS="backward",vms={},pageSlider={},prefixes=["webkit","moz","ms","o",""],prefixedEvent=function(r,i,t){for(var e=0;e<prefixes.length;e++)prefixes[e]||(i=i.toLowerCase()),r.addEventListener(prefixes[e]+i,t,!1)},ViewModel=function(){var e=_mithril2.default.prop({});return{pageElements:{},transition:e,clearTransition:function(){e().page=void 0},hasTransition:function(){return void 0!==e().page},orientation:_mithril2.default.prop(DEFAULT_ORIENTATION),current:_mithril2.default.prop(),currentId:_mithril2.default.prop(),previous:_mithril2.default.prop(),next:_mithril2.default.prop(),history:_mithril2.default.prop({}),depth:_mithril2.default.prop(0)}},getViewModel=function(){var e=arguments.length<=0||void 0===arguments[0]?DEFAULT_SLIDER_ID:arguments[0];return vms[e]=vms[e]||new ViewModel,vms[e]},pageElProps=function(i,r,e,t,n){return{key:r,class:n.pageClass||null,config:function(e,r){r||(t.pageElements[i]=e)},style:{"-webkit-animation-duration":e+"ms","animation-duration":e+"ms"}}},slide=function(r){var d=r.slider||DEFAULT_SLIDER_ID,e=getViewModel(d);if(!e.hasTransition()){var t=r.route||_mithril2.default.route(),l=r.id||t,o=e.currentId();if(void 0===o||o!==l){var i={page:r.page,id:l,route:t,done:r.done,direction:r.direction||DIRECTION_FORWARD,duration:r.duration||DEFAULT_DURATION};if(e.orientation(r.rtl?RTL_ORIENTATION:DEFAULT_ORIENTATION),e.current()){var a=e.depth(),u=e.history()[t],n=void 0!==u?u:a+i.direction,s=r.direction===DIRECTION_BACKWARD?!0:a>n;e.depth(n),e.history()[t]=n,s?(i.direction=DIRECTION_BACKWARD,e.previous(i.page)):(i.direction=DIRECTION_FORWARD,e.next(i.page)),e.transition(i)}else e.current(i.page),e.currentId(i.id),e.history()[i.route]=0,i.done&&i.done(),e.clearTransition();_mithril2.default.redraw()}}},slideDone=function(e){var i=e.transition(),t=i.route,r=i.done;e.current(i.page),e.currentId(i.id),i.direction===DIRECTION_BACKWARD?(e.next(e.current()),e.previous(null)):(e.previous(e.current()),e.next(null)),e.clearTransition(),_mithril2.default.route(t),r&&r()},createView=function(i,s){var e=getViewModel(s),u=e.previous(),n=e.current(),o=e.next(),r=e.transition(),l=e.hasTransition(),a=e.orientation(),t=void 0!==r.duration?r.duration:DEFAULT_DURATION,p=r.direction===DIRECTION_FORWARD?DIRECTION_FORWARD_CLASS:DIRECTION_BACKWARD_CLASS,d=[u?(0,_mithril2.default)(".page.previous",pageElProps("previous",1,t,e,i),u):null,n?(0,_mithril2.default)(".page.current",pageElProps("current",2,t,e,i),n):null,o?(0,_mithril2.default)(".page.next",pageElProps("next",3,t,e,i),o):null];return a===RTL_ORIENTATION&&d.reverse(),(0,_mithril2.default)("div",{class:["pageSlider",l?"animating":null,p,a,i.class||null].join(" "),config:function(){if(l){var i=function(){slideDone(e)};prefixedEvent(e.pageElements.current,"AnimationEnd",i)}}},d)},slideConfig=function(i,e){return function(r,t){t||(r.onclick=function(t){t.preventDefault(),e.route=r.getAttribute("href"),i(e)})}};pageSlider.slideInConfig=function(e){return slideConfig(pageSlider.slideIn,e)},pageSlider.slideOutConfig=function(e){return slideConfig(pageSlider.slideOut,e)},pageSlider.slideIn=function(e){e.direction=DIRECTION_FORWARD,slide(e)},pageSlider.slideOut=function(e){e.direction=DIRECTION_BACKWARD,slide(e)},pageSlider.view=function(n){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=e.slider||DEFAULT_SLIDER_ID,t=getViewModel(i);if(!t.hasTransition()){var r=e.page;r&&slide({slider:i,page:r,id:e.id,route:e.route,done:e.done,rtl:e.rtl})}return createView(e,i)},exports.default=pageSlider,module.exports=exports.default;